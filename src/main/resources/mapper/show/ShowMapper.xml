<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.teamprojeect.mapper.show.ShowMapper">
    <!--공연 등록-->
    <insert id="insert">
        INSERT INTO TBL_SHOW
        (SHOW_NUMBER, ARTIST_NUMBER, SHOW_NAME, SHOW_CONTENT, SHOW_DAY, SHOW_TIME , SHOW_ADDRESS, SHOW_LOCATION, SHOW_TYPE)
        VALUES(SEQ_SHOW.NEXTVAL, #{artistNumber}, #{showName}, #{showContent}, #{showDay}, #{showTime}, #{showAddress}, #{showLocation}, #{showType})
    </insert>

    <!--공연 수정-->
    <update id="update">
        UPDATE TBL_SHOW
        SET ARTIST_NUMBER = #{artistNumber}, SHOW_NAME = #{showName}, SHOW_CONTENT = #{showContent}, SHOW_DAY = #{showDay}, SHOW_TIME = #{showTime}, SHOW_ADDRESS = #{showAddress}, SHOW_LOCATION = #{showLocation}, SHOW_TYPE = #{showType}
        WHERE SHOW_NUMBER= #{showNumber}

    </update>

    <!--공연 삭제-->
    <delete id="delete">
        DELETE FROM TBL_SHOW
        WHERE SHOW_NUMBER = #{showNumber}
    </delete>
    
    <!--진행 예정 공연 // 진행 중 공연 목록-->
    <select id="getList" resultType="showVO">
        SELECT SHOW_NUMBER, ARTIST_NUMBER, SHOW_NAME, SHOW_CONTENT, SHOW_DAY, SHOW_TIME, SHOW_ADDRESS, SHOW_LOCATION, SHOW_TYPE
        FROM TBL_SHOW
        WHERE SHOW_DAY - SYSDATE > 0
        <choose>
            <when test='listDTO.artistType == "M"'>
                AND SHOW_TYPE = 1
            </when>
            <when test=' listDTO.artistType == "P"'>
                AND SHOW_TYPE = 2
            </when>
        </choose>

    </select>


    <!--진행 예정 공연 // 진행 중 공연 목록-->
    <select id="getListIng" resultType="showVO">
        SELECT SHOW_NUMBER, ARTIST_NUMBER, SHOW_NAME, SHOW_CONTENT, SHOW_DAY, SHOW_TIME, SHOW_ADDRESS, SHOW_LOCATION, SHOW_TYPE
        FROM TBL_SHOW
        WHERE 0 = TO_DATE(SHOW_DAY,'YY-MM-DD') - TO_DATE(SYSDATE,'YY-MM-DD')
        <choose>
            <when test=' listDTO.showLocation == "1"'>
                AND (WITH TBL_SHOW AS(
                SELECT SHOW_ADDRESS AS ADDR  FROM TBL_SHOW)
                SELECT SUBSTR(ADDR, 0, INSTR(ADDR, ' ', 1, 1))
                FROM TBL_SHOW) == '서울'
            </when>
            <when test=' listDTO.showLocation == "2"'>
                AND (WITH TBL_SHOW AS(
                SELECT SHOW_ADDRESS AS ADDR  FROM TBL_SHOW)
                SELECT SUBSTR(ADDR, 0, INSTR(ADDR, ' ', 1, 1))
                FROM TBL_SHOW) == '경기'
            </when>
            <when test=' listDTO.showLocation == "3"'>
                AND (WITH TBL_SHOW AS(
                SELECT SHOW_ADDRESS AS ADDR  FROM TBL_SHOW)
                SELECT SUBSTR(ADDR, 0, INSTR(ADDR, ' ', 1, 1))
                FROM TBL_SHOW) == '츙남'
                AND (WITH TBL_SHOW AS(
                SELECT SHOW_ADDRESS AS ADDR  FROM TBL_SHOW)
                SELECT SUBSTR(ADDR, 0, INSTR(ADDR, ' ', 1, 1))
                FROM TBL_SHOW) == '츙북'
            </when>
            <when test=' listDTO.showLocation == "4"'>
                AND (WITH TBL_SHOW AS(
                SELECT SHOW_ADDRESS AS ADDR  FROM TBL_SHOW)
                SELECT SUBSTR(ADDR, 0, INSTR(ADDR, ' ', 1, 1))
                FROM TBL_SHOW) == '강원'
            </when>
            <when test=' listDTO.showLocation == "5"'>
                AND (WITH TBL_SHOW AS(
                SELECT SHOW_ADDRESS AS ADDR  FROM TBL_SHOW)
                SELECT SUBSTR(ADDR, 0, INSTR(ADDR, ' ', 1, 1))
                FROM TBL_SHOW) == '전남'
                AND (WITH TBL_SHOW AS(
                SELECT SHOW_ADDRESS AS ADDR  FROM TBL_SHOW)
                SELECT SUBSTR(ADDR, 0, INSTR(ADDR, ' ', 1, 1))
                FROM TBL_SHOW) == '전북'
            </when>
            <when test=' listDTO.showLocation == "6"'>
                AND (WITH TBL_SHOW AS(
                SELECT SHOW_ADDRESS AS ADDR  FROM TBL_SHOW)
                SELECT SUBSTR(ADDR, 0, INSTR(ADDR, ' ', 1, 1))
                FROM TBL_SHOW) == '경남'
                AND (WITH TBL_SHOW AS(
                SELECT SHOW_ADDRESS AS ADDR  FROM TBL_SHOW)
                SELECT SUBSTR(ADDR, 0, INSTR(ADDR, ' ', 1, 1))
                FROM TBL_SHOW) == '경북'
            </when>
            <when test=' listDTO.showLocation == "7"'>
                AND (WITH TBL_SHOW AS(
                SELECT SHOW_ADDRESS AS ADDR  FROM TBL_SHOW)
                SELECT SUBSTR(ADDR, 0, INSTR(ADDR, ' ', 1, 1))
                FROM TBL_SHOW) == '제주특별자치도'
            </when>
        </choose>

    </select>

    <!--진행 예정 개수-->
    <select id="getTotalToday" resultType="_int">
        SELECT COUNT(*) FROM TBL_SHOW
    </select>

    <!--진행 예정 개수-->
    <select id="getTotalTodayIng" resultType="_int">
        SELECT COUNT(*) FROM TBL_SHOW
    </select>

    <!--공연 상세 페이지-->
    <select id="detail" resultType="showVO">
        SELECT SHOW_NUMBER, ARTIST_NUMBER, SHOW_NAME, SHOW_CONTENT, SHOW_DAY, SHOW_TIME, SHOW_ADDRESS, SHOW_LOCATION, SHOW_TYPE
        FROM TBL_SHOW
        WHERE SHOW_NUMBER = #{showNumber}
    </select>

</mapper>